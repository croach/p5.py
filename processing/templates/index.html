<html>
<head>
    <style type="text/css">
        body {
            text-align: center;
        }
        canvas {
            border: 1px solid #DEDEDE;
        }
    </style>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
    <script type="text/javascript">
    $(function() {
        var colors;
        var ws = new WebSocket("ws://localhost:{{ port }}/ws");
        var ctx;

        function getCanvas(w, h) {
            if ($("canvas").length === 0) {
                $("body").append('<canvas width="' + w + 'px" height="' + h + 'px">');
            }
            return $("canvas")[0];
        }

        // function point(x, y) {
        //     // var canvas = getCanvas(),
        //     //     ctx = canvas.getContext("2d");
        //     ctx.beginPath();
        //     ctx.arc(x, y, 1, 0, 2 * Math.PI);
        //     ctx.fill();
        // }

        // function point(x, y) {
        //     // var canvas = getCanvas(),
        //     //     ctx = canvas.getContext("2d");
        //     ctx.beginPath();
        //     ctx.moveTo(x, y);
        //     ctx.lineTo(x+1, y+1);
        //     ctx.stroke();
        // }

        function point(x, y) {
            ctx.fillRect(x, y, 1, 1);
        }

        ws.onmessage = function (evt) {
            var data = JSON.parse(evt.data),
                walkers = data.objects,
                canvas = getCanvas(data.canvas.width, data.canvas.height);
            ctx = canvas.getContext("2d");

            if (typeof colors === 'undefined') {
                colors = [];
                for (var i = walkers.length - 1; i >= 0; i--) {
                    colors[i] = Math.floor(Math.random() * 256).toString(16) +
                                Math.floor(Math.random() * 256).toString(16) +
                                Math.floor(Math.random() * 256).toString(16);
                };
            }
            for (var i = walkers.length - 1; i >= 0; i--) {
                var w = walkers[i];
                var color = colors[i];
                ctx.fillStyle = color;
                ctx.strokeStyle = color;
                point(w.x, w.y);
                // ctx.fillRect(w.x, w.y, 1, 1);
            };
        };
    });
    </script>
</head>
<body>
</body>
</html>